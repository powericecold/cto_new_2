<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Layer Test</title>
</head>
<body>
    <h1>Data Layer Test</h1>
    <p>Check the browser console for test results.</p>
    
    <script src="data.js"></script>
    <script>
        console.log('%c=== Data Layer Tests ===', 'color: blue; font-weight: bold; font-size: 16px;');
        
        console.log('\n1. Initialize DataStore (first run)');
        DataStore.initialize();
        
        console.log('\n2. Get all tasks:', DataStore.getAllTasks().length, 'tasks found');
        console.log('   Task titles:', DataStore.getAllTasks().map(t => t.title));
        
        console.log('\n3. Get all projects:', DataStore.getAllProjects().length, 'projects found');
        console.log('   Project names:', DataStore.getAllProjects().map(p => p.name));
        
        console.log('\n4. Get inbox tasks:', DataStore.getInboxTasks().length, 'tasks');
        console.log('   Inbox task titles:', DataStore.getInboxTasks().map(t => t.title));
        
        console.log('\n5. Get today tasks:', DataStore.getTodayTasks().length, 'tasks');
        console.log('   Today task titles:', DataStore.getTodayTasks().map(t => t.title));
        
        console.log('\n6. Get upcoming tasks:', DataStore.getUpcomingTasks().length, 'tasks');
        console.log('   Upcoming task titles:', DataStore.getUpcomingTasks().map(t => t.title));
        
        console.log('\n7. Get someday tasks:', DataStore.getSomedayTasks().length, 'tasks');
        console.log('   Someday task titles:', DataStore.getSomedayTasks().map(t => t.title));
        
        console.log('\n8. Get all tags:', DataStore.getAllTags());
        
        const projects = DataStore.getAllProjects();
        if (projects.length > 0) {
            const projectTasks = DataStore.getTasksByProject(projects[0].id);
            console.log('\n9. Get tasks by project "' + projects[0].name + '":', projectTasks.length, 'tasks');
            console.log('   Task titles:', projectTasks.map(t => t.title));
        }
        
        const tags = DataStore.getAllTags();
        if (tags.length > 0) {
            const taggedTasks = DataStore.getTasksByTag(tags[0]);
            console.log('\n10. Get tasks by tag "' + tags[0] + '":', taggedTasks.length, 'tasks');
            console.log('    Task titles:', taggedTasks.map(t => t.title));
        }
        
        console.log('\n%c=== Testing CRUD Operations ===', 'color: green; font-weight: bold;');
        
        console.log('\n11. Add new task');
        const newTask = DataStore.addTask({
            title: 'Test Task from Browser',
            notes: 'This is a test',
            tags: ['test', 'automated']
        });
        console.log('    Created task:', newTask.id, '-', newTask.title);
        
        console.log('\n12. Update task');
        const updatedTask = DataStore.updateTask(newTask.id, {
            title: 'Updated Test Task',
            status: 'completed'
        });
        console.log('    Updated task:', updatedTask.title, '- Status:', updatedTask.status);
        
        console.log('\n13. Get task by ID');
        const fetchedTask = DataStore.getTask(newTask.id);
        console.log('    Fetched task:', fetchedTask ? fetchedTask.title : 'NOT FOUND');
        
        console.log('\n14. Delete task');
        const deleted = DataStore.deleteTask(newTask.id);
        console.log('    Task deleted:', deleted);
        
        console.log('\n15. Verify task is deleted');
        const shouldBeNull = DataStore.getTask(newTask.id);
        console.log('    Task still exists:', shouldBeNull !== null);
        
        console.log('\n16. Add new project');
        const newProject = DataStore.addProject({ name: 'Test Project' });
        console.log('    Created project:', newProject.id, '-', newProject.name);
        
        console.log('\n17. Update project');
        const updatedProject = DataStore.updateProject(newProject.id, { name: 'Updated Test Project' });
        console.log('    Updated project:', updatedProject.name);
        
        console.log('\n18. Delete project');
        const projectDeleted = DataStore.deleteProject(newProject.id);
        console.log('    Project deleted:', projectDeleted);
        
        console.log('\n19. Test event subscription');
        let eventReceived = false;
        const unsubscribe = DataStore.subscribe((event) => {
            eventReceived = true;
            console.log('    Event received:', event.type);
        });
        
        DataStore.addTask({ title: 'Event Test Task' });
        console.log('    Event system working:', eventReceived);
        unsubscribe();
        
        console.log('\n20. Test persistence - Check localStorage');
        const taskCountBefore = DataStore.getAllTasks().length;
        console.log('    Tasks in memory:', taskCountBefore);
        
        const savedData = localStorage.getItem('getdone_app_state');
        console.log('    Data saved to localStorage:', savedData !== null);
        console.log('    Data size:', savedData ? savedData.length + ' characters' : 'N/A');
        
        console.log('\n%c=== All Tests Complete ===', 'color: purple; font-weight: bold; font-size: 16px;');
        console.log('%c✓ Data models defined correctly', 'color: green;');
        console.log('%c✓ LocalStorage persistence working', 'color: green;');
        console.log('%c✓ Sample data seeded on first run', 'color: green;');
        console.log('%c✓ Query helpers functioning', 'color: green;');
        console.log('%c✓ CRUD operations working', 'color: green;');
        console.log('%c✓ Event system operational', 'color: green;');
        console.log('\n%cData layer implementation successful! Reload the page to test persistence.', 'color: blue; font-size: 14px;');
    </script>
</body>
</html>
